{% extends 'includes/main.html' %} {% load render_table from django_tables2 %}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col">
      <div class="card card-custom gutter-b">
        <div class="card-header">
          <div class="card-title">
            <h2>{{page_title}}</h2>
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <div class="d-flex justify-content-between">
            <div></div>
          </div>

          <div class="text-end">
            {% if add_link %}
            <a href="{{ add_link }}" class="btn btn-info mr-6">Add New</a>
            {% endif %}
          </div>
        </div>
        <div class="card-body">
          {% if filter %} {% include 'includes/filter.html' %} {% endif %}
          <div class="table-responsive">{% render_table table %}</div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block js %}
<style>
  /* Custom CSS for the "Action" dropdown */
  #action-select {
    width: 70%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-top: 20px;
  }
  .filter {
    background-color: transparent !red;
  }
  /* Custom CSS for the "Go" button */
  #go-button {
    margin-top: 0px;
  }

  /* Custom CSS for the "Add New" button */
  .btn-info {
    margin-top: 10px;
  }

  /* Custom CSS for the "Filter" section (if applicable) */
  /* Add your custom styles for the filter section here */

  /* Optional: Style for selected items */
  .selected-item {
    background-color: #f5f5f5; /* Example background color */
  }
  /* Custom CSS to vertically align SweetAlert2 icon */
  .swal2-icon {
    margin-top: -10px; /* Adjust this value to align the icon as needed */
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
/>

<script>
  let selection = [];
  let selectTag = $('[name="selection"]');

  function toggle(source) {
    selectTag.prop("checked", source.checked);
    selection = []; // Clear the selection
    if (source.checked) {
      selectTag.each(function () {
        const rowValue = $(this).val();
        selection.push(rowValue);
        console.log("selected row", selection); // Log the value here
      });
    }
  }

  selectTag.change(function () {
    let value = $(this).val();
    if ($(this).is(":checked")) {
      selection.push(value); // Add value to the selection
    } else {
      const index = selection.indexOf(value);
      if (index !== -1) {
        selection.splice(index, 1); // Remove value from the selection
      }
    }
  });

  $("#go-button").click(function () {
    const selectedAction = $("#action-select").val();
    var postUrl = "{{ csrf_token }}"; // Default URL
    if ("{{ page_title }}" === "Company") {
      postUrl = "delete_or_certify/";
    } else if ("{{ page_title }}" === "Review") {
      postUrl = "delete_or_verify/";
    }

    if (selectedAction) {
      Swal.fire({
        title: `Are you sure you want to ${selectedAction} the selected items?`,
        text: "This action cannot be undone!",
        icon: "warning",
        buttons: ["Cancel", "Yes, continue"],
        dangerMode: true,
      }).then((willContinue) => {
        if (willContinue) {
          $.post(
            postUrl,
            {
              selected: selection,
              csrfmiddlewaretoken: "{{ csrf_token }}",
              action: selectedAction,
            },
            function (data, status) {
              if (status === "success" && data.message) {
                Swal.fire("Success!", data.message, "success").then(() => {
                  location.reload();
                });
              } else {
                Swal.fire("Error!", "Could not delete the items.", "error");
              }
            }
          ).fail(function () {
            Swal.fire("Error!", "Could not delete the items.", "error");
          });
        } else {
          Swal.fire("Action Canceled", "No items were deleted.", "info");
        }
      });
    } else {
      Swal.fire("Please select an action.", "", "warning");
    }
  });
</script>
{% endblock %}
